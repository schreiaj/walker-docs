<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <title>How does a walking robot walk?</title>
    <meta name="description" content="Explorable explainer of how to sequence legs for walking robots.">

    <!-- Pico.css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.1.1/css/pico.min.css">
</head>

<body>
    <!-- Header -->
    <header class="container">
        <hgroup>
            <h1>Walker Leg Sequencing Example</h1>
            <p>Let's explore a naive method of sequencing legs for walking robots.</p>
        </hgroup>
    </header>
    <!-- ./ Header -->


    <script>
        const singleLegSequence = [
            [0, 0, 0],
            [0, 0, .25],
            [2, 0, .25],
            [2, 0, 0],
            [1, 0, 0],
        ]

        const fourLegNoOffsetData = [
            { xOffset: 3, yOffset: 3, tOffset: 0, color: "red" },
            { xOffset: 3, yOffset: -3, tOffset: 0, color: "green" },
            { xOffset: -3, yOffset: 3, tOffset: 0, color: "blue" },
            { xOffset: -3, yOffset: -3, tOffset: 0, color: "yellow" },
        ]

        const fourLegOffsetData = [
            { xOffset: 3, yOffset: 3, tOffset: 0, color: "red" },
            { xOffset: 3, yOffset: -3, tOffset: 2, color: "green" },
            { xOffset: -3, yOffset: 3, tOffset: 4, color: "blue" },
            { xOffset: -3, yOffset: -3, tOffset: 6, color: "yellow" },
        ]

        const fourLegOffsetSequence = [
            [0, 0, 0],
            [0, 0, .25],
            [2, 0, .25],
            [2, 0, 0],
            [1.5, 0, 0],
            [1, 0, 0],
            [0.5, 0, 0],
            [0, 0, 0],
        ]
    </script>
    <!-- Main -->
    <main class="container">
        <section id="intro">
            <p>
                There are a lot of different ways to control legs for a walking robot. The simplest approach is to just
                have each leg attempt to run a gait sequence. The big downside - it has no idea what surface it is on so
                over uneven terrain it will struggle. But for getting something moving and simple teleoperated robots
                this approach is likely adequate to start.
            </p>
        </section>
        <!-- Preview -->
        <section id="single-leg">
            <h2>We're going to start with a single leg</h2>
            <p>
                More specifically, we're going to look at the target for the leg. Getting the leg to move to the target
                is called inverse kinematics and is a different topic.
            </p>
            <p>
                Below you'll see a red circle representing the target for the leg and a black circle representing the
                body.
            </p>
            <div data-signals="{singleT: 0, singleLegEnabled: false}"
                data-on-interval__duration.200ms="$singleLegEnabled && $singleT++">

                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <svg viewBox="-10 -10 20 20" width="200" height="200">
                        <circle r="1" cx="0" cy="0" stroke="light-dark(black, white)" fill="none" stroke-width="0.25">
                        </circle>
                        <circle data-attr-cx="3+singleLegSequence[$singleT%singleLegSequence.length][0]"
                            data-attr-cy="singleLegSequence[$singleT%singleLegSequence.length][1]"
                            data-attr-r="0.5+singleLegSequence[$singleT%singleLegSequence.length][2]" fill="red">
                        </circle>
                    </svg>
                    <button data-on-click="$singleLegEnabled = !$singleLegEnabled"><span
                            data-text="$singleLegEnabled ? 'Stop' : 'Start'"></span> Animation</button>
                </div>
                There are 4 distinct phases to the leg's movement:
                <ol>
                    <li>Lift - the leg lifts from the ground</li>
                    <li>Swing - the leg swings out in the direction of travel</li>
                    <li>Land - the leg lands on the ground</li>
                    <li>Retract - the leg retracts back away from the direction of travel</li>
                </ol>
                You'll notice, the circle representing the leg increases in diameter as it moves up in Z. This is just a
                visual effect because we're working in 2d.
            </div>

        </section>

        <section id="single-leg">
            <h2>Now let's add the other legs</h2>
            <p>
                We're going to start with 4 legs because it's easier to see what's going on with fewer legs
            </p>
            <p>
                Now we've added 3 more legs and are running the same gait sequence on each leg.
            </p>
            <div
                data-signals="{fourLegNoOffsetT: 0, fourLegNoOffsetEnabled: false, fourLegOffsetT: 0, fourLegOffsetEnabled: false}">

                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;"
                    data-on-interval__duration.200ms="$fourLegNoOffsetEnabled && $fourLegNoOffsetT++"">
                    <svg viewBox=" -10 -10 20 20" width="200" height="200">
                    <circle r="1" cx="0" cy="0" stroke="light-dark(black, white)" fill="none" stroke-width="0.25">
                    </circle>
                    <circle
                        data-attr-cx="fourLegNoOffsetData[0].xOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[0].tOffset)%singleLegSequence.length][0]"
                        data-attr-cy="fourLegNoOffsetData[0].yOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[0].tOffset)%singleLegSequence.length][1]"
                        data-attr-r="0.5+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[0].tOffset)%singleLegSequence.length][2]"
                        data-attr-fill="singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[0].tOffset)%singleLegSequence.length][2] > 0 ? 'none' : fourLegNoOffsetData[0].color"
                        data-attr-stroke="fourLegNoOffsetData[0].color" stroke-width="0.25"></circle>
                    <circle
                        data-attr-cx="fourLegNoOffsetData[1].xOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[1].tOffset)%singleLegSequence.length][0]"
                        data-attr-cy="fourLegNoOffsetData[1].yOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[1].tOffset)%singleLegSequence.length][1]"
                        data-attr-r="0.5+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[1].tOffset)%singleLegSequence.length][2]"
                        data-attr-fill="singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[1].tOffset)%singleLegSequence.length][2] > 0 ? 'none' : fourLegNoOffsetData[1].color"
                        data-attr-stroke="fourLegNoOffsetData[1].color" stroke-width="0.25"></circle>
                    <circle
                        data-attr-cx="fourLegNoOffsetData[2].xOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[2].tOffset)%singleLegSequence.length][0]"
                        data-attr-cy="fourLegNoOffsetData[2].yOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[2].tOffset)%singleLegSequence.length][1]"
                        data-attr-r="0.5+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[2].tOffset)%singleLegSequence.length][2]"
                        data-attr-fill="singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[2].tOffset)%singleLegSequence.length][2] > 0 ? 'none' : fourLegNoOffsetData[2].color"
                        data-attr-stroke="fourLegNoOffsetData[2].color" stroke-width="0.25"></circle>
                    <circle
                        data-attr-cx="fourLegNoOffsetData[3].xOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[3].tOffset)%singleLegSequence.length][0]"
                        data-attr-cy="fourLegNoOffsetData[3].yOffset+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[3].tOffset)%singleLegSequence.length][1]"
                        data-attr-r="0.5+singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[3].tOffset)%singleLegSequence.length][2]"
                        data-attr-fill="singleLegSequence[($fourLegNoOffsetT + fourLegNoOffsetData[3].tOffset)%singleLegSequence.length][2] > 0 ? 'none' : fourLegNoOffsetData[3].color"
                        data-attr-stroke="fourLegNoOffsetData[3].color" stroke-width="0.25"></circle>
                    </svg>
                    <button data-on-click="$fourLegNoOffsetEnabled = !$fourLegNoOffsetEnabled"><span
                            data-text="$fourLegNoOffsetEnabled ? 'Stop' : 'Start'"></span> Animation</button>
                </div>
                <p>You've probably just had the thought that the robot would just be moving in a circle with not actual
                    locomotion. We can fix that issue by adding an offset to the step each leg is doing. This will get
                    them to move in sequence.</p>

                <p>However, it does add a new requirement to our gait sequence. The retract phase needes to be longer
                    than the other phases.
                <p>How much longer depends on what sort of gait you're doing. For the simplest lift one leg at a time
                    gait we're going to do you need to make sure that when any one leg is in the air the remaining legs
                    are on the ground.
                <p>
                    We've tried to make it clear when those steps are happening by making the leg targets unfilled when
                    they should be in the air. Now let's see if we can tweak the gaint sequence and add offsets
                    appropriately.
                </p>


                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;"
                    data-on-interval__duration.200ms="$fourLegOffsetEnabled && $fourLegOffsetT++">
                    <svg viewBox="-10 -10 20 20" width="200" height="200">
                        <circle r="1" cx="0" cy="0" stroke="light-dark(black, white)" fill="none" stroke-width="0.25">
                        </circle>
                        <circle
                            data-attr-cx="fourLegOffsetData[0].xOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[0].tOffset)%fourLegOffsetSequence.length][0]"
                            data-attr-cy="fourLegOffsetData[0].yOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[0].tOffset)%fourLegOffsetSequence.length][1]"
                            data-attr-r="0.5+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[0].tOffset)%fourLegOffsetSequence.length][2]"
                            data-attr-fill="fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[0].tOffset)%fourLegOffsetSequence.length][2] > 0 ? 'none' : fourLegOffsetData[0].color"
                            data-attr-stroke="fourLegOffsetData[0].color" stroke-width="0.25"></circle>
                        <circle
                            data-attr-cx="fourLegOffsetData[1].xOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[1].tOffset)%fourLegOffsetSequence.length][0]"
                            data-attr-cy="fourLegOffsetData[1].yOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[1].tOffset)%fourLegOffsetSequence.length][1]"
                            data-attr-r="0.5+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[1].tOffset)%fourLegOffsetSequence.length][2]"
                            data-attr-fill="fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[1].tOffset)%fourLegOffsetSequence.length][2] > 0 ? 'none' : fourLegOffsetData[1].color"
                            data-attr-stroke="fourLegOffsetData[1].color" stroke-width="0.25"></circle>
                        <circle
                            data-attr-cx="fourLegOffsetData[2].xOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[2].tOffset)%fourLegOffsetSequence.length][0]"
                            data-attr-cy="fourLegOffsetData[2].yOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[2].tOffset)%fourLegOffsetSequence.length][1]"
                            data-attr-r="0.5+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[2].tOffset)%fourLegOffsetSequence.length][2]"
                            data-attr-fill="fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[2].tOffset)%fourLegOffsetSequence.length][2] > 0 ? 'none' : fourLegOffsetData[2].color"
                            data-attr-stroke="fourLegOffsetData[2].color" stroke-width="0.25"></circle>
                        <circle data-attr-cx="fourLegOffsetData[3].xOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[3].tOffset)%fourLegOffsetSequence.length][0]"
                            data-attr-cy="fourLegOffsetData[3].yOffset+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[3].tOffset)%fourLegOffsetSequence.length][1]"
                            data-attr-r="0.5+fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[3].tOffset)%fourLegOffsetSequence.length][2]"
                            data-attr-fill="fourLegOffsetSequence[($fourLegOffsetT + fourLegOffsetData[3].tOffset)%fourLegOffsetSequence.length][2] > 0 ? 'none' : fourLegOffsetData[3].color"
                            data-attr-stroke="fourLegOffsetData[3].color" stroke-width="0.25"></circle>
                    </svg>
                    <button data-on-click="$fourLegOffsetEnabled = !$fourLegOffsetEnabled"><span
                            data-text="$fourLegOffsetEnabled ? 'Stop' : 'Start'"></span> Animation</button>
                    
                </div>
            </div>

        </section>
        <!-- ./ Loading -->
    </main>
    <!-- ./ Main -->

    <!-- Footer -->
    <footer class="container">
        <small>Built by hand with <a href="https://data-star.dev/">DataStar</a> and <a href="https://picocss.com">Pico</a></small>
    </footer>
    <!-- ./ Footer -->


</body>

<script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@main/bundles/datastar.js"></script>

</html>